class t{constructor(e,n={},s=!1){this.$root=t.make(e,{...n,ctx:this},s)}static make(s,a={},r=!1){s||=a.tag;let c="svg"==s||a.svg||r?document.createElementNS("http://www.w3.org/2000/svg",s||"svg"):document.createElement(s||"div");t.update(c,a);for(let n of e)Object.defineProperty(c,n,{value:(...e)=>t[n](c,...e)});return n.forEach(t=>{t in a&&(c["_"+t]=a[t].bind(c.ctx,{el:c,ctx:c.ctx}))}),c._onResize&&(c._ro=new ResizeObserver(t=>{for(const e of t)if(e.target===c){c._onResize();break}}),c._ro.observe(c)),c}static update(t,e){if(!h.node(t)||!h.obj(e))return t;t.ctx=e.ctx??e.context??t.ctx;for(let[n,s]of Object.entries(e))u(t,n,s);return t._onUpdate?.(),e.also?.call(t.ctx,{el:t,ctx:t.ctx}),t}static mount(t,e){t&&(null==e?(t.parentNode?.removeChild(t),t._mounted=t._rendered=!1):t.parentNode!==e&&(e.appendChild(t),a(t)))}static clear(e,n=!0){if(e)for(;e.firstChild;)n&&t.clear(e.firstChild,!0),t.remove(e.firstChild,!1)}static remove(e,s=!0){e&&(s&&t.clear(e,!0),t.release(e),t.unbind(e),e._ro?.disconnect(),e._onDestroy?.(),n.forEach(t=>e["_"+t]=null),e.parentNode?.removeChild(e))}static replace(e,n,s=!0){return e&&(e.parentNode?.replaceChild(n,e),n&&(a(n),s&&(n.ctx=e?.ctx)),t.remove(e)),n}static release(t){t&&(Object.values(t._events??{}).forEach(({ev:e,fn:n,opts:s})=>t.removeEventListener(e,n,s)),t._events={})}static unbind(t){t&&(Object.values(t._states??{}).forEach(t=>t()),t._states={})}static makeShadow(e,n={},s=""){return e&&h.obj(n)?(h.node(e)||(e=document.createElement(e)),e.attachShadow({mode:"open"}),t.update(e.shadowRoot,{ctx:n.context??n.ctx,child:[{tag:"style",$:"style",text:s},n.child,n.children]}),delete n.child,delete n.children,t.update(e,n)):null}static setTemplate(e,n,s){t.templates.set(e,(...e)=>t.make(n,s(...e)))}static useTemplate(e,...n){const s=t.templates.get(e);return s?s(...n):null}static templates=new Map;static config=t.update}const e=["update","mount","clear","remove"],n=["onMount","onRender","onUpdate","onResize","onDestroy"],s=new Set(["tag","get","also","context","ctx","svg",...n]);function a(t,e=50){const n=()=>{t.isConnected&&(t._mounted||(t._mounted=!0,t._onMount?.()),t.clientWidth||t.clientHeight)?t._rendered||(t._rendered=!0,t._onRender?.()):e--&&requestAnimationFrame(n)};(t._onMount||t._onRender)&&n()}const r={children:"child",children_r:"child_r",text:"textContent",html:"innerHTML"},c={push(t,e){e.push(t)},$(t,e){t.ctx&&(t.ctx["$"+e]=t)},attrs(t,e){o("attrs",t,e,(e,n)=>t.setAttribute(e,n),e=>t.removeAttribute(e))},data(t,e){o("data",t,e,(e,n)=>t.dataset[e]=n,e=>delete t.dataset[e])},props(t,e){for(let n in e){let s=d(t,n,null,e[n]);t[n]=["min","max","step","selectedIndex"].includes(n)||"value"==n&&["number","range"].includes(t.type)?null==s||""===s||Number.isNaN(s)?"":+s:s??""}},transition(t,e){const{duration:n=300,easing:s="ease",delay:a=0,onEnd:r=null,...o}=e;t.style.transition=Object.keys(o).map(t=>`${t} ${n}ms ${s} ${a}ms`).join(", "),r&&c.events(t,{transitionend:{handler:r,once:!0}}),requestAnimationFrame(()=>c.style(t,o))},events(t,e){for(let n in e){let s=e[n],a={};if(h.obj(s)&&(a=s,s=s.handler,!s))continue;const r=e=>s.call(t.ctx,Object.assign(e,{el:t,ctx:t.ctx}));if(!a.once){const e=(t._events??={})[n];e&&t.removeEventListener(n,e.fn,e.opts),t._events[n]={ev:n,fn:r,opts:a}}t.addEventListener(n,r,a)}},events_r(e,n){t.release(e),c.events(e,n)},child(t,e){l(t,e)},child_r(e,n){t.clear(e),c.child(e,n)},style(t,e){i("style",t,e,e=>t.style.cssText+=e+";",(e,n)=>{e.startsWith("--")?t.style.setProperty(e,n):t.style[e]=n})},style_r(t,e){t.style.cssText="",c.style(t,e)},class(t,e){h.arr(e)&&(e=Object.fromEntries(e.filter(Boolean).map(t=>[t,!0]))),i("class",t,e,e=>e.split(/\s+/).forEach(e=>e&&t.classList.add(e)),(e,n)=>n?t.classList.add(e):t.classList.remove(e))},class_r(t,e){t.className="",c.class(t,e)},parent(e,n){t.mount(e,n)}};function o(t,e,n,s,a){for(let r in n){let c=d(e,t,r,n[r]);null==c?a(r):s(r,String(c))}}function i(t,e,n,s,a){if(h.str(n))s(n);else for(let s in n)"_raw"==s?c[t](e,n[s]):a(s,d(e,t,s,n[s]))}function l(e,n){n&&(h.str(n)?e.insertAdjacentHTML("beforeend",n):h.arr(n)?n.forEach(t=>l(e,t)):h.node(n)?t.mount(n,e):n instanceof t?t.mount(n.$root,e):h.obj(n)&&t.make(null,{ctx:e.ctx,...n,parent:e},e instanceof SVGElement))}function d(t,e,n,s){if(h.func(s))return s.call(t.ctx,{el:t,ctx:t.ctx});if(h.arr(s)&&h.state(s[0]))return s.map(s=>d(t,e,n,s))[0];if(h.state(s)){const a=(a,r)=>{r=s.map({el:t,ctx:t.ctx,name:a,value:r}),u(t,e,n?{[n]:r}:r),t._onUpdate?.()},r=`${e}.${n}.${s.name}`;let c=(t._states??={})[r];return c&&c(),t._states[r]=s._state.subscribe(s.name,a),s.map({el:t,ctx:t.ctx,name:s.name,value:s._state[s.name]})}return s}function u(t,e,n){if(s.has(e))return;(e=r[e]??e).startsWith("on")?(n={[e.slice(2).toLowerCase()]:n},e="events"):n=d(t,e,null,n);const a=c[e];null!=n&&a?a(t,n):c.props(t,{[e]:n})}const h={func:t=>"function"==typeof t,str:t=>"string"==typeof t,arr:t=>Array.isArray(t),node:t=>t instanceof Node,obj:t=>null!==t&&"object"==typeof t,state:t=>t&&t._state};class m{static svg=(t={},e={})=>({tag:"svg",...e,attrs:t});static rect=(t,e,n,s,a,r,c={},o={})=>({tag:"rect",...o,attrs:{...c,x:t,y:e,width:n,height:s,rx:a,ry:r}});static circle=(t,e,n,s={},a={})=>({tag:"circle",...a,attrs:{...s,cx:t,cy:e,r:n}});static line=(t,e,n,s,a={},r={})=>({tag:"line",...r,attrs:{...a,x1:t,y1:e,x2:n,y2:s}});static polyline=(t,e={},n={})=>({tag:"polyline",...n,attrs:{...e,points:t}});static polygon=(t,e={},n={})=>({tag:"polygon",...n,attrs:{...e,points:t}});static path=(t,e={},n={})=>({tag:"path",...n,attrs:{...e,d:t}});static text=(t,e,n,s={},a={})=>({tag:"text",...a,text:t,attrs:{...s,x:e,y:n}});static make=(e,n)=>t.make(e,n,!0);static update=t.update;static config=t.update}function p(t,e=""){if(e||(e=_(t)),x.has(e))return;const n=document.createElement("style");return n.textContent=t,document.head.appendChild(n),x.set(e,n),n}function f(t,e=""){e||(e=_(t));const n=x.get(e);n&&(x.delete(e),n.remove())}function _(t){let e=5381;for(let n=0;n<t.length;n++)e=(e<<5)+e+t.charCodeAt(n),e|=0;return e.toString(36)}Object.getOwnPropertyNames(m).forEach(t=>m["make_"+t]=(...e)=>m.make(null,m[t](...e)));const x=new Map;class v{constructor(t={}){this._data={},this._subs=new Map,this.addStates(t)}addStates(t){for(const e in t)e in this||e in this._data||(this._data[e]=t[e],Object.defineProperty(this,e,{get:()=>this._data[e],set:t=>{if(Object.is(this._data[e],t))return;this._data[e]=t;const n=this._subs.get(e);n&&n.forEach(n=>n(e,t))}}))}hasState(t){return t in this._data}bind(t,e=t=>t.value){return{_state:this,name:t,map:e}}subscribe(t,e){return this._subs.has(t)||this._subs.set(t,new Set),this._subs.get(t).add(e),()=>this._subs.get(t).delete(e)}}function g(t){return new v(t)}export{t as EL,m as SVG,v as State,p as addCSS,f as removeCSS,g as useState};